<html lang="en">

<head>
    <!-- <link href="stye.css" rel="stylesheet"> -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./styles/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,900,900i" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="./styles/swiper.min.css">
    <link href="./styles/25.css" rel="stylesheet" type="text/css" />
    <link href="./styles/home.css" rel="stylesheet" type="text/css" />
    <title>Home</title>
    <style>
        body{
            background-color: #333;
        }

        .header{
            padding: 40px;
            color: #fff;
            margin: 0 auto;
            margin-bottom: 40px;
        }
        .header h1,p{
            text-align: center;
        }

        .wheel{
            display: flex;
            justify-content: center;
            position: relative;
            margin: 120px 0;
        }

        .wheel > #canvas {
            width: 70vw;
        }
        .center-circle{
            width: 100px;
            height: 100px;
            border-radius: 60px;
            background-color: #fff;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }
        .triangle{
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 30px solid white;
            position: absolute;
            top: 50%;
            right: -26vw;
            transform: translateY(-50%);
        }

        textarea{
            background-color: rgba(20, 20, 20, 0.2);
            caret-color: #fff;
            resize: none;
            color: #fff;
        }
        .inputArea{
            display: flex;
            justify-content: center;
            margin-top: 40px;
        }
    </style>
    <script>
        let items = [];
        let targetItem = "";
        async function getWheelItems(){
            var requestOptions = {
                method: 'GET',
                redirect: 'follow'
            };

            return (await fetch("http://localhost:3001/rotation-luck/get-rotation-list", requestOptions)).json();
        }

        async function getTargetItem(){
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/x-www-form-urlencoded");

            var urlencoded = new URLSearchParams();
            urlencoded.append("email", "abc@cde.fgh");
            urlencoded.append("id", "122333");

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: urlencoded,
                redirect: 'follow'
            };

             return (await fetch("http://localhost:3001/rotation-luck/get-rotation-result", requestOptions)).json();

        }

        Promise.all([getWheelItems(), getTargetItem()]).then((values) => {
            items = values[0].map(item => item.title);
            targetItem = values[1].title;
            createWheel();
            draw()
        });
    </script>
</head>
<body>

  <div class="container-fluid">
    <div class="row">
      <div class="image">

      </div>
    </div> 
  </div>

<!-- Function sologain  -->

<div class="container-fluid">
  <div class="row">
      <div class="col-md-12" style="background-color: rgb(17, 27, 62);">
        <div class="sologain">
          <h2>NUTRI FOOD - TH TRUE MILK - VINAMILK</h2>
        </div>
      </div>
  </div>
</div>
  
<!-- Function giới thiệu sản phẩm -->

<!-- Row 0 product -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="box0">
        <h2>Thương hiệu mang tới "hạnh phúc đích thực"</h2>
      </div>
    </div>
  </div>
</div>


<!-- Row 1 product -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <div class="box1" style="padding: 20px; margin:5px;">
          <h2>Sữa VinaMilk</h2>
          <p>This is the content of Box 1.</p>
      </div>
    </div>

      <div class="col-md-6">
        <div class="box2" style="padding: 20px; margin:5px;">
          <h2>Sữa TH Milk</h2>
          <p>This is the content of Box 2.</p>
        </div>
      </div>
  </div>
</div>


<!-- Row 2 product -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <div class="box3" style="padding: 20px; margin:20px;">
          <h2>Sữa VinaMilk</h2>
          <p>This is the content of Box 1.</p>
      </div>
    </div>

      <div class="col-md-6">
        <div class="box4" style="padding: 20px; margin:20px;">
          <h2>Sữa TH Milk</h2>
          <p>This is the content of Box 2.</p>
        </div>
      </div>
  </div>
</div>


<!-- Row 3 product -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <div class="box5" style="padding: 20px; margin:12px;">
          <h2>Sữa VinaMilk</h2>
          <p>This is the content of Box 1.</p>
      </div>
    </div>

      <div class="col-md-6">
        <div class="box6" style="padding: 20px; margin:12px;">
          <h2>Sữa TH Milk</h2>
          <p>This is the content of Box 2.</p>
        </div>
      </div>
  </div>
</div>

<!-- Row 4 product -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <div class="box7" style="padding: 20px; margin:12px;">
          <h2>Sữa VinaMilk</h2>
          <p>This is the content of Box 1.</p>
      </div>
    </div>

      <div class="col-md-6">
        <div class="box8" style="padding: 20px; margin:12px;">
          <h2>Sữa TH Milk</h2>
          <p>This is the content of Box 2.</p>
        </div>
      </div>
  </div>
</div>


<!-- Row 5 product -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <div class="box7" style="padding: 20px; margin:12px;">
          <h2>Sữa VinaMilk</h2>
          <p>This is the content of Box 1.</p>
      </div>
    </div>

      <div class="col-md-6">
        <div class="box8" style="padding: 20px; margin:12px;">
          <h2>Sữa TH Milk</h2>
          <p>This is the content of Box 2.</p>
        </div>
      </div>
  </div>
</div>

<!-- Row 6 product -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <div class="box7" style="padding: 20px; margin:12px;">
          <h2>Sữa VinaMilk</h2>
          <p>This is the content of Box 1.</p>
      </div>
    </div>

      <div class="col-md-6">
        <div class="box8" style="padding: 20px; margin:12px;">
          <h2>Sữa TH Milk</h2>
          <p>This is the content of Box 2.</p>
        </div>
      </div>
  </div>
</div>




<!--</head>-->
<!---->
<!--<body >-->
<div class="header">
  <h1>WINNER</h1>
  <p id="winner">NONE</p>
</div>
<div class="wheel">
  <canvas class="" id="canvas" width="500" height="500"></canvas>
  <div class="center-circle" onclick="spin()">
      <div class="triangle"></div>
  </div>
  
</div>
<!--<div class="inputArea" onchange="createWheel()" style="display: none">-->
<!--  <textarea rows="20" cols="30" >cat-->
<!--dog-->
<!--cow-->
<!--duck-->
<!--sheep-->
<!--goat-->
<!--bird-->
<!--neko-->
<!--chicken</textarea>-->
<!--</div>-->

<script>
  function randomColor(){
      r = Math.floor(Math.random() * 255);
      g = Math.floor(Math.random() * 255);
      b = Math.floor(Math.random() * 255);
      return {r,g,b}
  }
  function toRad(deg){
      return deg * (Math.PI / 180.0);
  }
  function randomRange(min,max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function easeOutSine(x) {
      return Math.sin((x * Math.PI) / 2);
  }
  // get percent between 2 number
  function getPercent(input,min,max){
      return (((input - min) * 100) / (max - min))/100
  }
</script>

<script>
  const canvas = document.getElementById("canvas")
  const ctx = canvas.getContext("2d")
  const width = document.getElementById("canvas").width
  const height = document.getElementById("canvas").height

  const centerX = width/2
  const centerY = height/2
  const radius = width/2

  // let items //= document.getElementsByTagName("textarea")[0].value.split("\n");
  //   getWheelItems();
  let currentDeg = 0
  let step = 360/items.length
  let colors = []
  let itemDegs = {}

  for(let i = 0 ; i < items.length + 1;i++){
      colors.push(randomColor())
  }

  async function createWheel(){
      // items = (await getWheelItems()).map(item => item.title);//= document.getElementsByTagName("textarea")[0].value.split("\n");
      step = 360/items.length
      colors = []
      for(let i = 0 ; i < items.length + 1;i++){
          colors.push(randomColor());
      }
      draw()
  }


  function draw(){
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, toRad(0), toRad(360))
      ctx.fillStyle = `rgb(${33},${33},${33})`
      ctx.lineTo(centerX, centerY);
      ctx.fill()

      let startDeg = currentDeg;
      for(let i = 0 ; i < items.length; i++, startDeg += step){
          let endDeg = startDeg + step

          color = colors[i]
          let colorStyle = `rgb(${color.r},${color.g},${color.b})`

          ctx.beginPath();
          rad = toRad(360/step);
          ctx.arc(centerX, centerY, radius - 2, toRad(startDeg), toRad(endDeg))
          let colorStyle2 = `rgb(${color.r - 30},${color.g - 30},${color.b - 30})`
          ctx.fillStyle = colorStyle2
          ctx.lineTo(centerX, centerY);
          ctx.fill()

          ctx.beginPath();
          rad = toRad(360/step);
          ctx.arc(centerX, centerY, radius - 30, toRad(startDeg), toRad(endDeg))
          ctx.fillStyle = colorStyle
          ctx.lineTo(centerX, centerY);
          ctx.fill()

          // draw text
          ctx.save();
          ctx.translate(centerX, centerY);
          ctx.rotate(toRad((startDeg + endDeg)/2));
          ctx.textAlign = "center";
          if(color.r > 150 || color.g > 150 || color.b > 150){
              ctx.fillStyle = "#000";
          }
          else{
              ctx.fillStyle = "#fff";
          }
          ctx.font = 'bold 24px serif';
          ctx.fillText(items[i], 130, 10);
          ctx.restore();

          itemDegs[items[i]] = 
              {
              "startDeg": startDeg,
              "endDeg" : endDeg
              }
          

          // check winner
          if(startDeg%360 < 360 && startDeg%360 > 270  && endDeg % 360 > 0 && endDeg%360 < 90 ){
              document.getElementById("winner").innerHTML = items[i]
          }
      }
  }
  

  let speed = 0
  let maxRotation = randomRange(360* 3, 360 * 6)
  let pause = false
  function animate(){
      if(pause){
          return
      }
      speed = easeOutSine(getPercent(currentDeg ,maxRotation ,0)) * 20
      if(speed < 0.01){
          speed = 0
          pause = true
      }
      currentDeg += speed
      draw()
      window.requestAnimationFrame(animate);
  }
  
  function spin(){
      if(speed != 0){
          return
      }

      maxRotation = 0;
      currentDeg = 0
      createWheel()
      draw();

      
      maxRotation = (360 * 6) - itemDegs["Item 2"].endDeg + 10
      itemDegs = {}
      console.log("max",maxRotation)
      console.log(itemDegs);
      pause = false
      window.requestAnimationFrame(animate);
  }

</script>
    <div class="tt-map">
        <iframe src="https://www.google.com/maps/embed?pb=!1m23!1m12!1m3!1d3919.7121491069443!2d106.67175201462234!3d10.756653492334964!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m8!3e0!4m0!4m5!1s0x31752efd22f285cb%3A0x17639c2aef2832f1!2zMjc3LzMgVHLhuqduIFBow7osIFBoxrDhu51uZyA4LCBRdeG6rW4gNSwgVGjDoG5oIHBo4buRIEjhu5MgQ2jDrSBNaW5oLCBWaeG7h3QgTmFt!3m2!1d10.756653499999999!2d106.67394069999999!5e0!3m2!1svi!2s!4v1615167421611!5m2!1svi!2s" width="100%" height="600" style="border:0;" allowfullscreen="" loading="lazy" frameborder="0" style="border:0;" allowfullscreen="" aria-hidden="false" tabindex="0"></iframe>
      </div>
      <!-- end-map -->
      
      <div class="tt-footer">
        <div class="container">
           <div class="tt-footer-tt">
          <div class="row">
           
            <div class="col-md-6">
              <div class="tt-footer-sub1">
                <a href="#"><img src="./styles/Untitled.jpeg" alt="logo"></a>
              
                <div class="tt-footer-mr"><span>HÀ NAM MILK luôn đồng hành cùng khách hàng</span></div>
                <div class="tt-footer-mr"><span>HÀ NAM MILK Chất Lượng Cùng Năm Tháng</span></div>
                <div class="tt-footer-mr"><span>CUNG CẤP SỮA UY TIN VIỆT NAM</span></div>
                </div>
            </div>
            <div class="col-md-3">
              <div class="tt-footer-sub2">
                   
                     <h5>Liên hệ</h5>
                <div class="tt-footer-mr"> <span><i class="fa fa-map" ></i>Thôn Đô Quan, Xã Mộc Nam, Thị xã Duy Tiên, Tỉnh Hà Nam, Việt Nam</span></div>
                <div class="tt-footer-mr"><span><i class="fas fa-envelope"></i>HÀNAMMILK@gmail.com.vn</span></div>
                <div class="tt-footer-mr"><span><i class="fa  fa-phone" ></i>0700731083</span></div>
              </div>
            </div>
            <div class="col-md-3">
               <div class="tt-footer-sub3">
                    <h5>Chính sách công ty</h5>
                    <div class="tt-footer-mr"><span>Cung cấp dịch vụ</span></div>
                    <div class="tt-footer-mr"><span>Bảo mật thông tin</span></div>
                    <div class="tt-footer-mr"> <span>Chính sách bảo hành</span></div>
                    
              </div>
            </div>
          </div>
          </div>
        </div>
        <div class="tt-footer-ft">
          <div class="container">
          <span style="color: #Fff;">	HA NAM MILK JOINT STOCK COMPANY </span>
            <div class="st-top-menu-right">
                <i class="fab fa-facebook"></i>
                <i class="fab fa-twitter-square"></i>
                <i class="fab fa-google"></i>
                <i class="fab fa-pinterest"></i>
                <i class="fab fa-youtube"></i>
            </div>
        </div>
        </div>
      
      </div>
      <div class="tt-backto-top">
        
      <div id="button"></div>
      </div>
    <script src="./styles/src.js"></script>
</body>

</html>
